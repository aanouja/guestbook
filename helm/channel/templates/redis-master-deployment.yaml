apiVersion: app.ibm.com/v1alpha1
kind: Deployable
metadata:
  name: redis-master-deployment
  annotations:
#    app.ibm.com/is-local-deployable: "false"
  labels:
    app: redis
    tier: backend
spec:
  template:
    apiVersion: apps/v1 #  for k8s versions before 1.9.0 use apps/v1beta2  and before 1.8.0 use extensions/v1beta1
    kind: Deployment
    metadata:
      name: redis-master
    spec:
      selector:
        matchLabels:
          app: redis
          role: master
          tier: backend
      replicas: 1
      template:
        metadata:
          labels:
            app: redis
            role: master
            tier: backend
        spec:
          volumes:
            - name: data
              persistentVolumeClaim:
                claimName: redis-master-pvc
            - name: conf
              configMap:
                name: redis-master-configmap
                defaultMode: 0755
          containers:
          - name: master
            image: redis:5.0.1-alpine
            volumeMounts:
              - name: data
                mountPath: /data
              - name: conf
                mountPath: /conf
            command: ["redis-server", "/conf/redis.conf"]
            resources:
              requests:
                cpu: 100m
                memory: 100Mi
            ports:
            - containerPort: 6379
            - containerPort: 16379
